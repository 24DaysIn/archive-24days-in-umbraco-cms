<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">


	<title>Give me JSON</title>
<meta name="description" content="Learn how to output JSON from Umbraco via altTemplates, XSLT and the XSLToJSON package">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="/assets/24days-archive.css">
	<link rel="apple-touch-icon" href="/assets/24days-touch-icon.png">
		
	
	
</head>
<body>
	



<section class="page"><main class="article"><header><h1 class="header">Give me JSON</h1>
      <p class="byline"> by Thor Madsen-Holm, <span class="pubdate">posted on <time datetime="2012-12-11">Dec 11, 2012</time></span></p></header><div class="notification warning">
      <h2>Heads Up!</h2>
      <p>
					This article is several years old now, and much has happened since then,
					so please keep that in mind while reading it.
				</p>
    </div>
    <div class="content-column">
      <p class="teaser">As a frontend developer I love Umbraco because of the fact that I can get a very long way without ever touching any .NET code. In the last year or so I have been doing more and more work with AJAX, be it singlepage apps or just parts of a website that loads content asynchronously.</p>
<p class="intro">After loading content, I usually want to render it as HTML on the page. To do this, I create an altTemplate (see <a href="/umbraco-cms/2012/ajax-paging-using-alttemplates/">Matt's previous post about altTemplates</a>, if you want to know more) and insert an XSLT macro on that page.</p>
<p>In the past I usually had this macro render all the HTML I needed. Then when I requested the altTemplate, I could just inject the contents into the page like this:</p>
<pre class="language-javascript"><code>$.ajax({
	url: "alttemplateUrl",
	dataType: "html",
	success: function(html){
		$("#insertDataInThisElement").html(html);
	}
});</code></pre>
<p>And voila! New content is rendered on the page. This works great when you are working with smaller chunks of HTML and don't need to use data from the request that's not intended to be rendered.</p>
<p>So what can we do if we want something that's easier to work with in JavaScript than just <span class="ver">an HTML</span> string? We use JSON of course! But hey, how do I get Umbraco to output JSON without having to do any <span class="ver">.NET</span> work? If you are an XSLT man like I am, you simply install Peter Duncanson's brilliant package <a href="http://our.umbraco.org/projects/developer-tools/xsltojson"><span class="ver">XSLToJSON</span></a> (Which also works in Umbraco 4.11.1)</p>
<p>The package creates a <span class="code">toJSON</span><span class="ver"><span class="code">.xslt</span> macro</span> and a JSON <span class="ver">template. T</span>he XSLT macro outputs <span class="code">$currentpage</span> as JSON, like this:</p>
<pre class="language-markup"><code>&lt;xsl:template match="/"&gt;
	&lt;xsl:value-of select="orc.XSLToJSON:XmlToJson($currentPage)" /&gt;
&lt;/xsl:template&gt;</code></pre>
<p>See it in action by going to <strong>yourwebsite.com/JSON</strong> to see what it outputs.</p>
<p>You could extend this template to output a specific page by doing something like this: </p>
<pre class="language-markup"><code>&lt;xsl:variable name="pageId" select="umbraco.library:Request('pageid')" /&gt;

&lt;xsl:template match="/"&gt;
	&lt;!-- Make sure pageId is not empty --&gt;
	&lt;xsl:if test="normalize-space($pageId)"&gt;
		&lt;!-- Get the page --&gt;
		&lt;xsl:variable name="page" select="umbraco.library:GetXmlNodeById($pageId)" /&gt;

		&lt;!-- Output the page as JSON --&gt;
		&lt;xsl:value-of select="orc.XSLToJSON:XmlToJson($page)" /&gt;
	&lt;/xsl:if&gt;
&lt;/xsl:template&gt;</code></pre>
<p>Then you could get a specific page via JavaScript like this:</p>
<pre class="language-javascript"><code>$.ajax({
	url: "/JSON?pageId=1048",
	dataType: JSON,
	success: function(data){
		// Do something with the data
	}
});</code></pre>
<p>Now we could use a templating library such as handlebars.js to render the content on an HTML page.</p>
<p>If we do something like the example above, there is a good chance we won't need all the data from <span class="code">$currentPage</span>. Suppose we just need the <span class="code">title</span>, <span class="code">bodyText</span> and an image, we don't want to use precious bandwidth to load unnecessary content. So how can we get around that? We construct our own XML and pass it to the <span class="code">XmlToJson()</span> extension like this:</p>
<pre class="language-markup"><code>&lt;xsl:variable name="pageId" select="umbraco.library:Request('pageid')" /&gt;

&lt;xsl:template match="/"&gt;
	&lt;!-- Make sure pageId is not empty --&gt;
	&lt;xsl:if test="normalize-space($pageId)"&gt;
		&lt;!-- Get the page --&gt;
		&lt;xsl:variable name="page" select="umbraco.library:GetXmlNodeById($pageId)" /&gt;

		&lt;xsl:variable name="customXml"&gt;
			&lt;root&gt;
				&lt;!-- We use normalize-space() in the apply-templates statement to ensure we only get elements that have content --&gt;
				&lt;xsl:apply-templates select="$page/title[normalize-space()]" /&gt;
				&lt;xsl:apply-templates select="$page/bodyText[normalize-space()]" /&gt;
				&lt;xsl:apply-templates select="$page/image[normalize-space()]" /&gt;
			&lt;/root&gt;
		&lt;/xsl:variable&gt;

		&lt;!-- Output the page as JSON --&gt;
		&lt;!-- Because we constructed the xml ourselves we need to use msxml:node-set() to convert it to a nodeset --&gt;
		&lt;xsl:value-of select="orc.XSLToJSON:XmlToJson(msxml:node-set($customXml))" /&gt;
	&lt;/xsl:if&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match="title"&gt;
	&lt;title&gt;
		&lt;xsl:value-of select="." /&gt;
	&lt;/title&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match="bodyText"&gt;
	&lt;bodyText&gt;
		&lt;xsl:value-of select="." disable-output-escaping="yes"/&gt;
	&lt;/bodyText&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match="image"&gt;
	&lt;xsl:variable name="imageXml" select="umbraco.library:GetMedia(., 0)" /&gt;

	&lt;!-- It wouldn't be of much use if we only returned the media id, so we get the url --&gt;
	&lt;imageUrl&gt;
		&lt;xsl:value-of select="$imageXml/umbracoFile" /&gt;
	&lt;/imageUrl&gt;
&lt;/xsl:template&gt;</code></pre>
<p>Now when we request the altTemplate with a pageid as parameter, like this: yourwebsite.com/alttemplate<strong>?pageid=1048</strong>, we only get the <span class="code">title</span>, <span class="code">bodyText</span> and <span class="code">imageUrl</span>.</p>
<p>Here's the JSON output from a random page I created: </p>
<pre class="language-javascript"><code>{
   "root":{
      "title":"OMG! This is JSON",
      "bodyText":"Umbraco modules encapsulate specific bits of advanced functionality that are easily added to your website.",
      "imageUrl":"/media/35/bender_bending_rodriguez.jpg"
   }
}</code></pre>
<p>And that's how you can get JSON data from an altTemplate with the use of the XSLToJSON package.</p>
<p>I'm no Razor expert, but I'm sure you can do something similar there.</p>
<p>That's it, now go make something awesome with JSON from Umbraco :)</p>
<p>Happy holidays!</p>
    </div><footer><ul class="tags">
        <li><a rel="tag" href="https://24days.in/umbraco-cms/tags/frontend/" title="See all articles tagged with Frontend">Frontend</a></li>
        <li><a rel="tag" href="https://24days.in/umbraco-cms/tags/masterpages/" title="See all articles tagged with Masterpages">Masterpages</a></li>
        <li><a rel="tag" href="https://24days.in/umbraco-cms/tags/webforms/" title="See all articles tagged with Webforms">Webforms</a></li>
        <li><a rel="tag" href="https://24days.in/umbraco-cms/tags/v4/" title="See all articles tagged with v4">v4</a></li>
        <li><a rel="tag" href="https://24days.in/umbraco-cms/tags/v6/" title="See all articles tagged with v6">v6</a></li>
      </ul></footer><section class="bios"><div class="bio">
        <div class="gravatar" title="Thor Madsen-Holm"><img src="//gravatar.com/avatar/3bc8c7af674fd6df46e892dca87785cf.jpg?d=mm&amp;s=150" srcset="//gravatar.com/avatar/3bc8c7af674fd6df46e892dca87785cf.jpg?d=mm&amp;s=300 2x" width="150" height="150"></div>
        <h1>Thor Madsen-Holm</h1>
        <p>Thor is on Twitter as <a href="//twitter.com/thormadsenholm" title="Thor Madsen-Holm on Twitter" rel="author">@thormadsenholm</a></p>
      </div></section><section class="comments"><div id="disqus_thread"></div></section></main><nav class="dates-navbar"><a href="/umbraco-cms/2012/" class="home-link"><span class="scr-text">Home</span></a><ol>
      <li><a title="The Tale of the 3 CMSs" href="/umbraco-cms/2012/the-tale/"><span class="scr-text">The Tale of the 3 CMSs</span></a></li>
      <li><a title="Using DocTypeMixins" href="/umbraco-cms/2012/doctypemixins/"><span class="scr-text">Using DocTypeMixins</span></a></li>
      <li><a title="1-1 Multilingual Websites in Umbraco" href="/umbraco-cms/2012/multilingual-1-1/"><span class="scr-text">1-1 Multilingual Websites in Umbraco</span></a></li>
      <li><a title="How to view source with pride" href="/umbraco-cms/2012/how-to-view-source-with-pride/"><span class="scr-text">How to view source with pride</span></a></li>
      <li><a title="Introducing The umbraco:image Control" href="/umbraco-cms/2012/introducing-the-umbraco-image-control/"><span class="scr-text">Introducing The umbraco:image Control</span></a></li>
      <li><a title="Ajax Paging Using AltTemplates" href="/umbraco-cms/2012/ajax-paging-using-alttemplates/"><span class="scr-text">Ajax Paging Using AltTemplates</span></a></li>
      <li><a title="Post build events for Package devs" href="/umbraco-cms/2012/post-build-events-for-package-devs/"><span class="scr-text">Post build events for Package devs</span></a></li>
      <li><a title="How to extend the back-office..." href="/umbraco-cms/2012/extending-the-back-office/"><span class="scr-text">How to extend the back-office...</span></a></li>
      <li><a title="Community engagement" href="/umbraco-cms/2012/community-engagement/"><span class="scr-text">Community engagement</span></a></li>
      <li><a title="DAMP Gallery" href="/umbraco-cms/2012/damp-gallery/"><span class="scr-text">DAMP Gallery</span></a></li>
      <li class="selected"><a title="Give me JSON" href="/umbraco-cms/2012/give-me-json/"><span class="scr-text">Give me JSON</span></a></li>
      <li><a title="Optimising Umbraco for speed" href="/umbraco-cms/2012/optimise-for-speed/"><span class="scr-text">Optimising Umbraco for speed</span></a></li>
      <li><a title="Remember the Editors!" href="/umbraco-cms/2012/remember-the-editors/"><span class="scr-text">Remember the Editors!</span></a></li>
      <li><a title="On Being a Superhero" href="/umbraco-cms/2012/superhero/"><span class="scr-text">On Being a Superhero</span></a></li>
      <li><a title="Bulk-Assigning Media Items" href="/umbraco-cms/2012/bulk-assigning-media/"><span class="scr-text">Bulk-Assigning Media Items</span></a></li>
      <li><a title="The importance of great images ... and how you achieve them" href="/umbraco-cms/2012/great-images/"><span class="scr-text">The importance of great images ... and how you achieve them</span></a></li>
      <li><a title="Media Query opt-out with Umbraco" href="/umbraco-cms/2012/media-query-opt-out/"><span class="scr-text">Media Query opt-out with Umbraco</span></a></li>
      <li><a title="Who Picked This ?" href="/umbraco-cms/2012/who-picked-this/"><span class="scr-text">Who Picked This ?</span></a></li>
      <li><a title="Razor and Faceted Search In Umbraco" href="/umbraco-cms/2012/razor-faceted-search/"><span class="scr-text">Razor and Faceted Search In Umbraco</span></a></li>
      <li><a title="Creating a Login form with Umbraco MVC SurfaceController" href="/umbraco-cms/2012/creating-a-login-form-with-umbraco-mvc-surfacecontroller/"><span class="scr-text">Creating a Login form with Umbraco MVC SurfaceController</span></a></li>
      <li><a title="Favorite Pages for Members" href="/umbraco-cms/2012/member-favorites/"><span class="scr-text">Favorite Pages for Members</span></a></li>
      <li><a title="AutoIcons, Conventions in Umbraco" href="/umbraco-cms/2012/autoicons-conventions-in-umbraco/"><span class="scr-text">AutoIcons, Conventions in Umbraco</span></a></li>
      <li><a title="Quick Tips for Improving your Callouts" href="/umbraco-cms/2012/improving-callouts/"><span class="scr-text">Quick Tips for Improving your Callouts</span></a></li>
      <li><a title="Wrapping Up: Building this Site" href="/umbraco-cms/2012/wrapping-up/"><span class="scr-text">Wrapping Up: Building this Site</span></a></li>
      <li><a title="One more thing..." href="/umbraco-cms/2012/one-more-thing/"><span class="scr-text">One more thing...</span></a></li>
    </ol></nav></section>


	<script type="module" src="/assets/ipuzzler.js"></script>
	<script defer src="/assets/libs.min.js"></script>
	<script defer src="/assets/app.js"></script>
	
</body>
</html>
