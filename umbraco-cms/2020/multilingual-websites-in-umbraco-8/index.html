<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">


	<title>Building Multilingual Websites in Umbraco 8</title>
<meta name="description" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="/assets/24days-archive.css">
	<link rel="apple-touch-icon" href="/assets/24days-touch-icon.png">
		
	
	
</head>
<body>
	



<section class="page"><main class="article"><header><h1 class="header">Multilingual Websites in Umbraco 8</h1>
      <p class="byline"> by Dan Booth, <span class="pubdate">posted on <time datetime="2020-12-02">Dec 2, 2020</time></span></p></header><div class="notification warning">
      <h2>Heads Up!</h2>
      <p>
					This article is several years old now, and much has happened since then,
					so please keep that in mind while reading it.
				</p>
    </div>
    <div class="content-column">
      <p class="teaser"><span style="font-weight: 400;">I’d like to share with you the journey I went on when building my first multilingual websites in Umbraco 8 (in the current climate it’s probably the only journey I’ll be going on for a while). Like any good journey it has is its ups and downs, diversions and occasional u-turns (almost as many as the Boris Johnson government, in fact!). </span></p>
<p class="intro"><span style="font-weight: 400;">My aim is to guide you through the different problems you may encounter and, hopefully, provide advice, some solutions and even the odd code snippet you can use.</span></p>
<h2><span style="font-weight: 400;">Who’s It For?</span></h2>
<p><span style="font-weight: 400;">I guess the target audience for this article are experienced Umbraco developers who have never built a multi language site in Umbraco 8 but are considering doing so.</span></p>
<p><span style="font-weight: 400;">It’s important to note that this isn’t a step-by-step guide to creating a multilingual site - it’s more of a high-level take on what you will encounter and what to consider before embarking on your own journey. It contains details of the issues I encountered - which you’ll likely also encounter - so they won’t surprise you if they should arise.</span></p>
<p><span style="font-weight: 400;">Before we start, though, it’s worth reviewing the options we had for building multilingual sites <em>before</em> Umbraco 8 came along.</span></p>
<h2><span style="font-weight: 400;">Umbraco 7</span></h2>
<p><span style="font-weight: 400;">In Umbraco 7 (and earlier) we had two main ways of building a multi-language site:</span></p>
<h3><span style="font-weight: 400;">Multi Tenancy</span></h3>
<p><span style="font-weight: 400;">This is where you would have multiple home pages within one website, each containing pages devoted to a separate language. In order to create a new language you’d clone the homepage and children, change the language / hostname and then an editor would be expected to go through and translate the copy. It was probably the most common way of creating multilingual websites in Umbraco, and worked quite well, but wasn’t necessarily very easy for editors to work with. </span></p>
<p><span style="font-weight: 400;">For instance, if you had 8 languages and an editor wanted to create a new page in each, they would have to go into each site, locate the relevant parent page and then create the new page (or copy it over) 8 times. Assets (such as media) would be copied rather than shared, meaning that to change an image across all languages would involve having to edit multiple pages. It wasn’t the “friendly” experience we would hope - but it did work and was relatively straightforward to produce.</span></p>
<h3><span style="font-weight: 400;">One to One</span></h3>
<p><span style="font-weight: 400;">This method required only one instance of a page - solving one of our issues with multi-tenancy - but added a slew of new problems to solve. How do we add different copy for each language to one document type? The answer would typically be either naively adding multiple fields (eg. <strong>Heading_en</strong>, <strong>Heading_dk</strong> etc) or using a package like </span><a rel="noopener" href="https://our.umbraco.com/packages/backoffice-extensions/vorto/" target="_blank" title="Vorto Package by Matt"><span style="font-weight: 400;">Vorto </span></a><span style="font-weight: 400;">which cleverly allowed you to “wrap” property editors, allowing you to have one field but many languages. </span></p>
<p><span style="font-weight: 400;">Whilst these methods worked, they never felt “native” to Umbraco and still left you with many problems to solve, such as creating unique URLs for each language. The fact is, Umbraco 7 and earlier were never designed to be used in this way.</span></p>
<h2><span style="font-weight: 400;">Umbraco 8 To The Rescue</span></h2>
<p><span style="font-weight: 400;">When Umbraco 8 was released in February 2019 (another lifetime to most of us now!) it heralded “language variants” as one of its </span><a rel="noopener" href="https://umbraco.com/blog/introducing-umbraco-8/" target="_blank" title="Umbraco 8 Release Blog"><span style="font-weight: 400;">Big Three Features</span></a><span style="font-weight: 400;">. It promised:</span></p>
<blockquote><span style="font-weight: 400;">“Wave goodbye to workarounds, hacks, and syncing with external packages. In Umbraco 8, management of language variants is part of the CMS. Based on popular demand, we have made it possible for you to update, create and manage your multilingual content in a simpler way.”</span></blockquote>
<p><span style="font-weight: 400;">In other words, Umbraco 8 had been architected with the concept of multilingual content within its core. It was baked in, rather than needing to be hacked on. It was one of it’s biggest selling points in all the promotional literature. </span></p>
<p><span style="font-weight: 400;">However, it’s important to realise that the approach of Umbraco 8 was specifically aimed at creating One to One sites (you can, of course, still use the multi-tenancy approach but this is not what Umbraco 8 encourages or promotes). Bear that in mind.</span></p>
<h2><span style="font-weight: 400;">New Umbraco 8 Features</span></h2>
<p><span style="font-weight: 400;">Very quickly let's look at what is new in Umbraco 8 in regard to languages:</span></p>
<ul>
<li style="font-weight: 400;"><strong>Variants</strong><span style="font-weight: 400;"> - this takes the concept of Vorto but bakes it into the core of Umbraco, so that any property can be varied by language.</span></li>
<li style="font-weight: 400;"><strong>Inheritance</strong><span style="font-weight: 400;"> - you can configure Umbraco so that it will "fall back" to a default language if no content is supplied. You can also make a language mandatory.</span></li>
<li style="font-weight: 400;"><strong>Preview</strong><span style="font-weight: 400;"> - you can easily switch between languages in the Umbraco preview.</span></li>
<li style="font-weight: 400;"><strong>Switching</strong> <span style="font-weight: 400;">- a new language menu sits over the content tree to make it simple to switch which language is currently being edited.</span></li>
<li style="font-weight: 400;"><strong>Side by side editing</strong><span style="font-weight: 400;"> -  the ability for editors to see a split view between two languages, making it much easier to translate content.</span></li>
</ul>
<p><span style="font-weight: 400;">Again, all these methods very much encourage you down the road of creating One to One sites. If you want to read more about these features then check out <span>Harriet Lawrie's great overview article <a rel="noopener" href="/umbraco-cms/2019/multilingual-websites-in-umbraco-8/" target="_blank" title="By Harriet Lawrie, 2019">Multilingual websites in Umbraco 8</a> from 2019's '24 Days in Umbraco'.</span></span></p>
<h2><span style="font-weight: 400;">Think Carefully!</span></h2>
<p><span style="font-weight: 400;">My first (and most important) piece of advice would be to find out how your client will be managing their content and whether a One to One solution actually fits with their requirements. Do this before you do anything else. A thorough "discovery phase" is key to success as it ensures your assumptions and your client's assumptions actually align!</span></p>
<p><span style="font-weight: 400;">Whilst a One to One solution undoubtedly makes editing multilingual content much more friendly there are some things to consider first:</span></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Will each site have the same content and structure? Or is there a requirement to have different content and structures for each site? If the latter, then a One to One solution might not be the best fit.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Will there be a mandatory language that is required before a page can be published? In this case Umbraco 8 makes this simple, so it’s a good choice.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Is there a requirement so that editors can only edit a specific language? Currently there is no way to limit editor permissions to a specific language in Umbraco 8 - there is an </span><a rel="noopener" href="https://github.com/umbraco/Umbraco-CMS/issues/3830" target="_blank" title="Github"><span style="font-weight: 400;">open Github issue for this</span></a><span style="font-weight: 400;">. If this is important to your client then you need to discuss this and be open.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Do you want to share content between language variants? For instance, share the same mast hero image across all pages? In this case, Umbraco 8 is a good fit.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Will your client want to create content in one language that doesn’t appear in the other sites? Whilst this is perfectly possible in Umbraco 8 it requires some thought on how to set-up, since the assumption of One to One is always that there is a “lead” or default language which the other content is translated from. If the sites are all going to contain essentially different content you may be better going the multi-tenancy way.</span></li>
</ul>
<h2><span style="font-weight: 400;">Setting Up Umbraco 8</span></h2>
<p><span style="font-weight: 400;">I’m not going to go into great detail about how to set up a multilingual site in Umbraco as this is </span><a rel="noopener" href="https://our.umbraco.com/Documentation/Getting-Started/Backoffice/Variants/" target="_blank" title="Umbraco language variants documentation"><span style="font-weight: 400;">covered in the documentation</span></a><span style="font-weight: 400;">. However, it’s worth reminding ourselves of these key things:</span></p>
<h3><span style="font-weight: 400;">Languages</span></h3>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">You first create the languages you want in Settings. You will always have to create one default language and there can only be one default language.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">You can configure a language to be mandatory ie. all required fields must be populated for that language before you can publish any page.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">You can set a language so that it will “fall back” to any other language you have created. For instance, if you have a US and UK site you can make it so that the UK site will fall back to showing the US content if none is supplied for the UK site (we’ll just have to overlook the fact that Americans can’t spell :p).</span></li>
</ul>
<p><img style="width: 500px; height: 136.1323155216285px;" src="/archive/media/2020/languages.png?width=500&amp;height=136.1323155216285" alt="Language Settings" data-udi="umb://media/c4bf27b53774494ea5bd3826a5835413"></p>
<h3><span style="font-weight: 400;">Host Names and Domains</span></h3>
<p><span style="font-weight: 400;">For each language you create you will need to bind a hostname and culture (language) to your root page (usually the home page). You can use either fully qualified domain names or just use a root path fragment (eg. /en/ or /es). Just remember to do this for </span><span style="font-weight: 400;">every</span><span style="font-weight: 400;"> language you create, otherwise you will find you can publish pages but they won’t be rooted to a path and won’t be given a URL. (I made this mistake once and spent an hour wondering why my page didn’t have a URL for the Chinese version!).</span></p>
<p><img style="width: 482px; height: 379px;" src="/archive/media/2020/hostnames.png?width=482&amp;height=379" alt="Hostnames and Cultures" data-udi="umb://media/4a38f656603c457f9cc9ce782799d0b6"></p>
<h3><span style="font-weight: 400;">Variants</span></h3>
<p><span style="font-weight: 400;">It’s important to realise that variants work on two levels - on the entire Document Type and also at the individual Property level. You first need to enable “<strong>Allow varying by culture</strong>” on the doc type - this signals to Umbraco you want to enable language variants for the document. Once you have done that you can then enable a similar setting on each individual property you create. In other words, you can decide on a </span><em><span style="font-weight: 400;">property by property</span></em><span style="font-weight: 400;"> basis whether you want to enable language variants for that content. Let’s consider this for a moment…</span></p>
<p><span style="font-weight: 400;">Let’s imagine we are creating an Events section with events for five different languages where the requirement is that every event has to be translated into each configured language. Now a very simple Event might have three different properties:</span></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;"><strong>Date</strong> - a date picker</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;"><strong>Image</strong> - a media picker</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;"><strong>Content</strong> - a rich text editor for the main copy</span></li>
</ul>
<p><span style="font-weight: 400;">Let’s assume these are all mandatory (required) properties - they <em>all</em> need to be set to publish your event.</span></p>
<p><span style="font-weight: 400;">It would make sense to enable “<strong>Allow vary by culture</strong>” on the Content rich-text property - this is copy that needs translating. But the event date will be the same for all languages - dates can’t be translated (though, of course, they may display differently or be in different time zones). Similarly, it would make the Editor’s life much easier if they only needed to add an image once and that this was then shared between <em>all</em> variants of the event. So there would be no need to enable the “<strong>Allow vary by culture</strong>” checkbox on Image and Date as these are “shared” properties across all languages.</span><span style="font-weight: 400;"></span></p>
<p><img style="width: 375.98116169544744px; height: 500px;" src="/archive/media/2020/vary-by-culture.png?width=375.98116169544744&amp;height=500" alt="Vary by culture on a Property" data-udi="umb://media/6f7647d4894946d4887d62ce272d528b"></p>
<h3><span style="font-weight: 400;">What Could Go Wrong?</span></h3>
<p><span style="font-weight: 400;">This sounds great doesn’t it? We have made our editors lives much easier and we have also ensured that the date is consistent across all variations of the event - there’s no chance that an editor supplies the wrong date in one version of the event. We have also made it much easier to manage the Event image - if it needs updating it only has to be updated once. Fantastic!</span></p>
<p><span style="font-weight: 400;">But, if we haven’t enabled “<strong>Allow vary by culture</strong>” on the Date and Image, in which language variant do they reside? Where are they set (they’re mandatory after all)? Well, the answer goes back to when we </span><span style="font-weight: 400;">created our Languages</span><span style="font-weight: 400;"> - you <em>always</em> have to supply a default language. So, for example, if we set the default language as English then it would be in this content tree that you would need to first create the Event - setting it’s Date and Image properties. And, because these are mandatory properties, you have to set them before you can publish this page in </span><span style="font-weight: 400;">any</span><span style="font-weight: 400;"> language.</span></p>
<h3><span style="font-weight: 400;">Can You Just...</span></h3>
<p><span style="font-weight: 400;">Yep, those three little words that fill a developer's heart with dread! “Can you just…”</span></p>
<p><span style="font-weight: 400;">Now, imagine you’ve completed the site, deployed live and your client is really happy with their new shiny multilingual site. You are one happy developer, right? </span></p>
<p><span style="font-weight: 400;">But a couple of months later you are informed the client has made a “small” request. They now need to create a new Event which is only relevant to their German audience, so they “just” want the event to appear in the German site and not appear on the UK or other language sites… </span></p>
<p><span style="font-weight: 400;">Seems an innocuous request, right? But if you’ve been paying attention you’ll realise the problem we now have. English is the default language. It’s where the date and image are set for <em>every</em> Event (where they </span><em><span style="font-weight: 400;">have</span></em><span style="font-weight: 400;"> to be set as they’re mandatory). Oh dear. Our One to One architecture just doesn’t really allow for this.</span></p>
<h3><span style="font-weight: 400;">So what can you do?</span></h3>
<p><span style="font-weight: 400;">Well, you could tell your client that it just isn’t possible. But, c’mon, we all know clients aren’t going to be happy with that. After all, it seems like such a simple request, doesn’t it?</span></p>
<p><span style="font-weight: 400;">So, assuming you can’t or won’t tell them it’s not possible, then you have to start thinking about unravelling your architecture. For a start, if they want to create Events in German but not in English then you really have no choice but to make the Date and Image properties “<strong>vary by culture</strong>”. This means you will now be able to add the Date and Image to the German version without requiring you to create a UK version first. Of course, this immediately does away with the whole point of why we made them invariant in the first place - convenience for the editor!</span></p>
<p><span style="font-weight: 400;">But you also want to ensure that every Event has a Date and an Image - so this means they have to be mandatory. And now you have another problem - all your existing events will suddenly require you to set the date and image for each language as they are mandatory! Oh dear, this is getting worse. Are you going to have to tell the client they now have to go through all the events and re-add the date and image for every language? That is not a conversation you want to be having...</span></p>
<p><span style="font-weight: 400;">But, hang on, what if we just use inheritance? Genius! You recall that when you create a language in Umbraco you can set it so that it “falls back” to another language. So what happens if we make German “fall back” to English if no content is set? That means that the client wouldn’t need to add an Image or Date for events where it was already set in the default language version - we can just “inherit” it. The developer in you feels just a little bit smug at coming up with this great solution!</span></p>
<h3><span style="font-weight: 400;">Fall On Me</span></h3>
<p><span style="font-weight: 400;">But wait… The first thing we need to realise is that falling back to a language <em>doesn’t happen automatically</em>. Sure, we can tick the box in the <a rel="noopener" href="https://our.umbraco.com/documentation/Getting-Started/Backoffice/Variants/#how-to-enable-language-variants" target="_blank" title="Language settings documentation" data-anchor="#how-to-enable-language-variants">Language settings</a>, but this doesn’t in itself change anything. If you want to fall back to a value you need to explicitly specify this when accessing the property. This is </span><a rel="noopener" href="https://our.umbraco.com/Documentation/Getting-Started/Design/Rendering-Content/" target="_blank" title="Umbraco Variant Documentation"><span style="font-weight: 400;">covered in the documentation</span></a><span style="font-weight: 400;">, but to recap you need to use the following slightly arcane syntax in a view:</span></p>
<p><span class="code" style="font-weight: 400;">@Model.Value("image", "fr", fallback: Fallback.ToLanguage)</span></p>
<p><span style="font-weight: 400;">This will check if there is an image set for the language with the ISO language code “fr” (French) and, if there is not, fall back to our default language (which, in this case, is “en” or English).</span></p>
<p><span style="font-weight: 400;">If you are using Models Builder you’ll need to code it like this:</span></p>
<p><span style="font-weight: 400;"><span class="code" style="font-weight: 400;">@model.ValueFor(x =&gt; x.Image, "fr", fallback: Fallback.ToLanguage)</span></span></p>
<p><span style="font-weight: 400;"><span style="font-weight: 400;">Or if you are using an older version of Umbraco 8 then it would be:</span></span></p>
<p><span class="code" style="font-weight: 400;">@model.Value(x =&gt; x.Image, "fr", fallback: Fallback.ToLanguage)</span></p>
<p><span style="font-weight: 400;">As you can see, you’ll need to start updating your code for this to work. And all those nicely strongly-typed Models Builder models are suddenly not quite so nice to work with. Luckily there is a work-around for Models Builder which you can use, thanks to some great work by Jeroen Vantroyen - have a read of his article <a rel="noopener" href="http://jvantroyen.blogspot.com/2020/07/umbraco-enabling-language-fallback-by.html" target="_blank" title="Enabling Language Fallback by default">Umbraco - Enabling Language Fallback by default</a> for the lowdown if you are interested.</span></p>
<p><span style="font-weight: 400;"><strong>Note:</strong> You can access the current "Culture" via the Culture property exposed in every Razor view. </span></p>
<p><span style="font-weight: 400;">But we have a bigger problem than that… </span></p>
<p><span style="font-weight: 400;">Let’s recap. If you want to fall-back to the default language for a property you will need to leave that property empty (ie. not set a value). Do you see the problem yet? Yep, that means we can no longer make the property mandatory (required). In other words, to use inheritance to solve our initial problem we now need to make it so both the event Date and Image are no longer required properties. This is not good because those are essential to the “referential integrity” of our data - you can’t have an event without a date, after all!</span></p>
<p><span style="font-weight: 400;">So, basically you have a choice to make - do we want it to be mandatory <em>or</em> do we leave it empty so it can fall-back to another language? ‘Cos you ain’t having both! </span><span style="font-weight: 400;"></span></p>
<p><span style="font-weight: 400;">As you now see, the choices you make at the start of a project can greatly restrict the flexibility you have down the line. This is why it’s so important to get the client requirements at the start so you can consider these problems before they come to bite you. You can have flexibility at the price of convenience or convenience at the price of flexibility - but not both. Be warned! One to One is great...until it isn’t.</span></p>
<h2><span style="font-weight: 400;">The Repeatable Content Problem</span></h2>
<p><span style="font-weight: 400;">As Jane Austen once said, “It is a truth universally acknowledged, that a website of any degree of complexity will require repeatable content.” She was a wise woman.</span></p>
<p><span style="font-weight: 400;">By repeatable content I mean any content that is defined as Element Types, such as those you will find in </span><a rel="noopener" href="https://our.umbraco.com/Documentation/Getting-Started/Backoffice/Property-Editors/Built-in-Property-Editors/Nested-Content/" target="_blank" title="Nested Content Documentation"><span style="font-weight: 400;">Nested Content</span></a><span style="font-weight: 400;">, Stacked Content, The Grid or the new fancy-pants </span><a rel="noopener" href="https://our.umbraco.com/Documentation/Getting-Started/Backoffice/Property-Editors/Built-in-Property-Editors/Block-List-Editor/" target="_blank" title="Article about the Block List Editor"><span style="font-weight: 400;">Block List Editor</span></a><span style="font-weight: 400;">. I find that in most non-trivial sites I build that the majority of content is now composed using such an editor, so this is no minor thing.</span></p>
<p><span style="font-weight: 400;">So why is this a problem? Well, the plain fact is that you <em>can’t</em> “<strong>vary by culture</strong>” an Element Type. Well, actually you</span><span style="font-weight: 400;"> can</span><span style="font-weight: 400;">, because the interface quite happily lets you do this - but it doesn’t actually </span><em><span style="font-weight: 400;">do </span></em><span style="font-weight: 400;">anything. The problem is the way that Element Types are stored and serialised as JSON. As </span><a rel="noopener" href="https://github.com/umbraco/Umbraco-CMS/issues/5532" target="_blank" title="Github Issue Discussion"><span style="font-weight: 400;">a reply to this open issue on Github puts it</span></a><span style="font-weight: 400;">:</span></p>
<blockquote><span style="font-weight: 400;">“</span><span style="font-weight: 400;">This can't be fixed without completely rewriting the way element types are stored, as currently all data is stored as JSON in a single property. There's a RFC to change this, but the feature to keep variants in sync is explicitly stated as being out of scope: </span><a rel="noopener" href="https://github.com/umbraco/rfcs/pull/24" target="_blank" title="Umbraco Request for Change consultation"><span style="font-weight: 400;">umbraco/rfcs#24</span></a><span style="font-weight: 400;">.”</span></blockquote>
<p><span style="font-weight: 400;">In other words, Element Types have <strong>no way</strong> of storing an associated culture currently. Maybe in the future this will change if </span><a rel="noopener" href="https://github.com/umbraco/rfcs/pull/24" target="_blank" title="Request for Change discussion"><span style="font-weight: 400;">RFCS 24 </span></a><span style="font-weight: 400;">comes to fruition, but as we all know, telling a client something may happen in future is not likely to placate them.</span></p>
<h3><span style="font-weight: 400;">So What Happens?</span></h3>
<p><span style="font-weight: 400;">To understand the problem, let’s imagine we have to build a very simple Image Gallery component for a page using Nested Content. Our requirement is to have an image, a heading and a short caption. So we’d create an Element Type with three properties: Heading, Image, Caption and then create a Nested Content data type that lets you add, say, up to 20 of these elements within a page. We’ll call this property Image Gallery and we’ll vary it by culture.</span></p>
<p><span style="font-weight: 400;">Now, ideally what our client wants is for the images to be added just once - so they are shared across all language variants. But they do require the Heading and Caption fields to be translated into all available languages.</span></p>
<p><span style="font-weight: 400;">However, this isn’t currently possible as we can’t “<strong>vary by culture</strong>” the Heading and Caption with the element types. Sure, you can set the Image Gallery property (that uses the Nested Content datatype) to be “<strong>varied by culture</strong>” but this treats it as a <em>single property</em>. The individual elements that make it up can’t be varied.</span></p>
<p><span style="font-weight: 400;">In other words, we have to tell our client that they will need to add the images to </span><em><span style="font-weight: 400;">each</span></em><span style="font-weight: 400;"><em> language separately</em> along with the translated Heading and Caption. They can’t be shared. And, if like me, your site content is mostly comprised of this type of repeatable content then you will find one of the big advantages of Umbraco 8 has just been diminished.</span></p>
<h3><span style="font-weight: 400;">Copy'n'Paste to the Rescue</span></h3>
<p><span style="font-weight: 400;">Luckily all is not quite as bad as it seems. The interface for Nested Content (and other editors) has been updated to allow you to copy and paste element types. This means you can go into split view in Umbraco and copy the nested content from one language to another fairly easily (though this feature isn’t inherently obvious if you are not aware of it). So, in our example, you could copy the entire Image Gallery from the English site to the German site in a couple of clicks and then you’d have the same images - all you would need to do is edit them and translate them. This still leaves you with a lot of duplicated content, but it’s still better than having to add it all again manually.</span></p>
<p><img style="width: 260px; height: 134px;" src="/archive/media/2020/copy-nested-content.png?width=260&amp;height=134" alt="Copy Nested Content" data-udi="umb://media/6ee84ecdc79a43b590c01ae3b33f5eb0"></p>
<p><img style="width: 397px; height: 260px;" src="/archive/media/2020/paste-content.png?width=397&amp;height=260" alt="Paste Nested Content" data-udi="umb://media/d2a70a5e9d5a4f3c849100a87a9d4795"></p>
<h2><span style="font-weight: 400;">Searching with Examine</span></h2>
<p><span style="font-weight: 400;">Another issue you are likely to encounter with Umbraco 8 is how Examine indexes multilingual content. By default you will just have one External Index which contains content for all available cultures.</span></p>
<p><span style="font-weight: 400;">If you look at an Examine index for Umbraco 8 you’ll also notice that each indexed property now has the culture appended to its field name. For instance, if you have a property called ‘heading’ it will now become ‘<strong>heading_en_gb</strong>’ or ‘<strong>heading_da_dk</strong>’ etc. This allows you to distinguish between content from different cultures, but does fundamentally change your search queries. If you are relying on a 3rd party package for search that isn’t aware of this it's likely not to work.</span></p>
<p><span style="font-weight: 400;">You’ll also see some special fields added to the index that let you know it varies by culture and which versions are published. Something like this:</span></p>
<p><span class="code"><span style="font-weight: 400;">__Published_en-gb </span><span style="font-weight: 400;">y</span></span></p>
<p><span class="code"><span style="font-weight: 400;">__Published_da-dk </span><span style="font-weight: 400;">y</span></span></p>
<p><span class="code"><span style="font-weight: 400;">__VariesByCulture </span><span style="font-weight: 400;">y</span></span></p>
<p><span style="font-weight: 400;">I won’t go into how to write a search for Umbraco 8, as this is a topic in its own right. Instead, I’d refer you to the article </span><a rel="noopener" href="https://skrift.io/issues/examine-in-umbraco-8/" target="_blank" title="Examine in Umbraco 8 by Paul Marden"><span style="font-weight: 400;">‘Examine in Umbraco 8’</span></a><span style="font-weight: 400;"> by Paul Marden published by Skrift. It touches on accessing multilingual properties and provides a good starting point. The main thing is to be aware of this before embarking on building a site.</span></p>
<h2><span style="font-weight: 400;">Picking Content</span></h2>
<p><span style="font-weight: 400;">In any site you will often have content pickers - these can be the standard Content Picker data type or maybe you are more hip and use the snappily named Multi Node Tree Picker. Either way, you need to be able to select content from the site you are editing.</span></p>
<p><span style="font-weight: 400;">You would <em>expect</em> that if the editor has set the content tree to, say, the German site then the content picker would just show you pages in that particular site in that language. However, this doesn't always seem to be the case in Umbraco 8 - quite often it will show you the tree in the default language (eg. English) regardless of what language the content tree is set to. There are <a rel="noopener" href="https://github.com/umbraco/Umbraco-CMS/issues/8097" target="_blank" title="Github Issue">open issues</a> for this but it's another little gripe you may well encounter.</span></p>
<h2><span style="font-weight: 400;">Partial Caching</span></h2>
<p><span style="font-weight: 400;">For optimum performance you will want to cache many of your partials. However, in a multilingual site you also want to ensure that you don't cache, say, the French content and show that on the English site. Before Umbraco 8.8 came along this was quite easy to do by mistake (and because partials aren't cached when debug mode is enabled, you might not notice until you deployed live!).</span></p>
<p><span style="font-weight: 400;">Take for instance this innocuous statement to cache a partial for an hour:</span></p>
<p><span class="code" style="font-weight: 400;">@Html.CachedPartial("MyPartial", Model, 3600)</span></p>
<p><span style="font-weight: 400;">Now imagine you have a site in English and French. If the <em>very first request</em> for the page with your cached partial is from the French version then the French content would be cached and subsequently shown on every further request - to both language sites. Those poor English people wouldn't have a clue what was going on! :) Likewise, if the first request was to the English language version it would be cached in English - for both sites. This could be a very difficult bug to spot!</span></p>
<p><span style="font-weight: 400;">Luckily the amazing Marc Goodson submitted a PR to "<a rel="noopener" href="https://github.com/umbraco/Umbraco-CMS/pull/8348" target="_blank" title="Github PR by Marc">Add the current culture to the cache key for the CachedPartial Html Helper</a>" which fixes this issue in <a rel="noopener" href="https://our.umbraco.com/download/releases/880" target="_blank" title="Umbraco 8.8 release notes">Umbraco 8.8</a> and later. However, if you are using an older version of Umbraco you can achieve the same effect using the <span class="code">contextualKeyBuilder</span> parameter that allows you to specify a custom cache key:</span></p>
<p><span class="code" style="font-weight: 400;">@Html.CachedPartial("<span style="font-weight: 400;">MyPartial</span>", Model, 3600, contextualKeyBuilder: (m, v) =&gt; Culture)</span></p>
<h2><span style="font-weight: 400;">Bonus Content!</span></h2>
<p><span style="font-weight: 400;">OK, if you’ve gotten this far you’ve probably realised that whilst the multilingual features in Umbraco 8 are very welcome they are specifically geared toward One to One sites where the assumption is that you will always have a default language, with the other sites being translated from this default language. There are issues with falling back to default language, especially if you use a lot of repeatable content.</span></p>
<p><span style="font-weight: 400;">But there are other advantages you will find in Umbraco 8 that can make multilingual sites much nicer.</span></p>
<h3><span style="font-weight: 400;">Switching Languages</span></h3>
<p><span style="font-weight: 400;">One common requirement of any multilingual site is to switch between the various languages on offer. Sure, you can use fancy tricks like </span><a rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API" target="_blank" title="Mozilla docs on Geolocation"><span style="font-weight: 400;">geolocation</span></a><span style="font-weight: 400;"> or checking the </span><a rel="noopener" href="https://www.w3.org/International/questions/qa-lang-priorities#:~:text=Checking%20your%20Accept%2DLanguage%20headers,Request%20Headers%20%3E%20Accept%2DLanguage%20." target="_blank" title="W3C Docs on browser languages" data-anchor="#:~:text=Checking%20your%20Accept%2DLanguage%20headers,Request%20Headers%20%3E%20Accept%2DLanguage%20."><span style="font-weight: 400;">browser language heade</span></a><span style="font-weight: 400;">r to send someone to the “correct” site, but ultimately you still need a way of choosing manually. This is why nearly all sites will have some kind of switch language menu.</span></p>
<p><span style="font-weight: 400;">Ideally this switching will work at the page level. So, for instance, if someone lands on a German event page and switches the language to English they will be taken to the exact same event page but in English.</span></p>
<p><span style="font-weight: 400;">In multi-tenancy sites this was always very difficult, if not downright impossible. This is because there is no direct relationship between the pages - each page is completely separate and doesn’t have any “knowledge” of its variants. Sure, you can try and be clever and use the </span><a rel="noopener" href="https://our.umbraco.com/documentation/reference/management/services/relationservice/" target="_blank" title="Relationship Service documentation"><span style="font-weight: 400;">Relationship API</span></a><span style="font-weight: 400;"> in Umbraco to make these connections, but when you have more than two languages this gets very problematic to enforce. In most multi-tenancy sites I just had to leave it so the switcher took you to the home page every time.</span></p>
<p><span style="font-weight: 400;">However, in One to One sites there is that internal relationship and we can leverage this fact to make a nicer language switcher that keeps the visitor on the same page even when they switch language.</span></p>
<p><span style="font-weight: 400;">To do this we take advantage of the new <span class="code">Cultures</span> property on <span class="code">IPublishedContent</span>. This allows us to loop over all the available cultures (languages) for a document. This means that when we are on any given page we can access all the other page variants, which we can use to create our language selector. We can also be a bit clever and check if a particular language doesn’t exist then we can make our selection default back to the home page for the site. This ensures our language picker always works even if a page doesn’t have all the variants created for it. We can also add some (optional) caching to further improve performance.</span></p>
<p><span style="font-weight: 400;">So, without further ado, here’s a couple of code snippets that can achieve this:</span></p>
<p><span style="font-weight: 400;">The first is a razor partial that displays a language picker dropdown using Bootstrap 4 styling (you can obviously change this to use your own framework or styling):</span></p>
<pre><code class="language-javascript">@inherits UmbracoViewPage
@using Diplo.Web.Language
@*
    Example Language Switcher using Bootstrap 4
*@
@{
    var languages = Model.GetCurrentLanguageList(Culture, AppCaches);
    var selected = languages.FirstOrDefault(x =&gt; x.Current);
    string currentName = selected != null ? selected.Name : Culture;

    if (languages == null)
    {
        return;
    }
}

&lt;li class="nav-item dropdown"&gt;
    &lt;button class="btn nav-link dropdown-toggle" id="languageDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"&gt;@currentName&lt;/button&gt;
    &lt;div class="dropdown-menu dropdown-menu-right" aria-labelledby="languageDropdown"&gt;
        @foreach (var item in languages)
        {
            &lt;a class="dropdown-item d-block @Html.If(item.Name == currentName, "active")" href="@item.Url"&gt;@item.Name&lt;/a&gt;
        }
    &lt;/div&gt;
&lt;/li&gt;

</code></pre>
      <p class="snippet-caption">Razor view partial to display a language picker using Bootstrap 4 styling</p>
<p>This partial code consumes a couple of helper classes / extension methods that generate the list of available URLs based on the current passed in page. It also uses Caching to cache the root languages to keep things snappy! Here it is:</p>
<pre><code class="language-csharp">using System;
using System.Collections.Generic;
using System.Linq;
using Umbraco.Core;
using Umbraco.Core.Cache;
using Umbraco.Core.Models.PublishedContent;
using Umbraco.Web;

namespace Diplo.Web.Language
{
    public static class LanguageExtensions
    {
        public class CultureUrl
        {
            /// &lt;summary&gt;
            /// The culture string eg. en-GB
            /// &lt;/summary&gt;
            public string Culture { get; set; }

            /// &lt;summary&gt;
            /// The page URL
            /// &lt;/summary&gt;
            public string Url { get; set; }

            /// &lt;summary&gt;
            /// Gets the short name eg. GB
            /// &lt;/summary&gt;
            public string Name =&gt; this.Culture?.Length &gt; 2 ? this.Culture?.Substring(3, 2).ToUpper() : this.Culture?.ToUpper();

            /// &lt;summary&gt;
            /// Gets whether this is the currently selected page
            /// &lt;/summary&gt;
            public bool Current { get; set; }
        }

        /// &lt;summary&gt;
        /// Generates the list of languages for the page dropdown. If there is a parallel page using same culture then this is used, otherwise it falls back to the root URL.
        /// &lt;/summary&gt;
        /// &lt;param name="currentPage"&gt;The currently viewed page&lt;/param&gt;
        /// &lt;param name="currentCulture"&gt;The current culture&lt;/param&gt;
        /// &lt;returns&gt;A list of languages and cultures&lt;/returns&gt;
        public static List&lt;CultureUrl&gt; GetCurrentLanguageList(this IPublishedContent currentPage, string currentCulture, AppCaches caches)
        {
            var home = currentPage.Root();
            var rootCultures = GetRootCultures(home, caches);
            var pageCultures = currentPage.Cultures.Select(x =&gt; x.Value);

            var mapped = new List&lt;CultureUrl&gt;();

            foreach (var root in rootCultures)
            {
                var pageMatch = pageCultures.FirstOrDefault(c =&gt; c.Culture == root.Culture);

                CultureUrl mappedPage = null;

                if (pageMatch != null)
                {
                    string url = currentPage.Url(pageMatch.Culture);

                    if (url != "#")
                    {
                        mappedPage = new CultureUrl()
                        {
                            Culture = pageMatch.Culture,
                            Url = url
                        };
                    }
                }

                if (mappedPage == null)
                {
                    mappedPage = new CultureUrl()
                    {
                        Culture = root.Culture,
                        Url = home.Url(root.Culture)
                    };
                }

                mappedPage.Current = mappedPage.Culture.InvariantEquals(currentCulture);

                mapped.Add(mappedPage);
            }

            return mapped;
        }

        private static IEnumerable&lt;PublishedCultureInfo&gt; GetRootCultures(IPublishedContent currentPage, AppCaches caches)
        {
            return caches.RuntimeCache.GetCacheItem("RootCultures", () =&gt; currentPage.Cultures.Select(x =&gt; x.Value).ToList());
        }
    }

}
</code></pre>
      <p class="snippet-caption">C# code to create a list of languages and domains for a given item of Published Content</p>
<p><span style="font-weight: 400;">Hopefully the above code examples will be enough to get you started creating your own picker :)</span></p>
<h3><span style="font-weight: 400;">Generating HrefLang Tags</span></h3>
<p><span style="font-weight: 400;">Another important thing for any multilingual site is to ensure it has </span><a rel="noopener" href="https://moz.com/learn/seo/hreflang-tag" target="_blank" title="Moz article about Hreflang tags"><span style="font-weight: 400;">Hreflang tags</span></a><span style="font-weight: 400;">. These are a special type of metadata (added to your document HEAD) that help search engines understand the relationship between the different language pages in your site. </span></p>
<p><span style="font-weight: 400;">You can quickly generate these tags like this:</span></p>
<pre><code class="language-javascript">@foreach (var culture in Model.Cultures)
{
    string url = Model.Url(culture: culture.Key, mode: UrlMode.Absolute);

    if (!string.IsNullOrEmpty(url) &amp;&amp; url != "#")
    {
        &lt;link rel="alternate" href="@Model.Url(culture: culture.Key, mode: UrlMode.Absolute)" hreflang="@culture.Key" /&gt;
    }
}</code></pre>
      <p class="snippet-caption">Generating Hreflang tags using Razor in Umbraco 8</p>
<p><span style="font-weight: 400;">You’ll notice I check if the URL is both empty and also not equal to the “#” as sometimes you find the API returns this rather than an empty string. <em>C'est la vie! :)</em></span></p>
<p><span style="font-weight: 400;">You also will spot I’m using the overload for the <span class="code">Url()</span> extension method on <span class="code">IPublishedContent</span> that allows you to pass in the culture and specify you want an absolute URL returned. </span></p>
<p><span style="font-weight: 400;"><strong>Note:</strong> You should always use the <span class="code">Url()</span> extension method going forward as the Url property is now deprecated.</span></p>
<h2><span style="font-weight: 400;">Conclusion</span></h2>
<p><span style="font-weight: 400;">So should you use Umbraco 8 for One to One multilingual sites? That’s not something I can answer for you as each site will be different and each client will have their own requirements. Hopefully, though, with the help of this article you’ll be able to consider all the angles and ask the right questions before starting coding! (I know that is hard).</span></p>
<p><span style="font-weight: 400;">I also personally hope that Umbraco gets a little more love in this regard - the wizards at HQ have already solved many difficult problems and created a very slick editing experience - but there is more that needs to be done to make it more flexible. I’m sure it will get there!</span></p>
    </div><footer><ul class="tags">
        <li><a rel="tag" href="/umbraco-cms/tags/v8/" title="See all articles tagged with v8">v8</a></li>
        <li><a rel="tag" href="/umbraco-cms/tags/backoffice/" title="See all articles tagged with Backoffice">Backoffice</a></li>
        <li><a rel="tag" href="/umbraco-cms/tags/developer/" title="See all articles tagged with Developer">Developer</a></li>
        <li><a rel="tag" href="/umbraco-cms/tags/dictionary/" title="See all articles tagged with Dictionary">Dictionary</a></li>
        <li><a rel="tag" href="/umbraco-cms/tags/information-architecture/" title="See all articles tagged with Information architecture">Information architecture</a></li>
        <li><a rel="tag" href="/umbraco-cms/tags/planning/" title="See all articles tagged with Planning">Planning</a></li>
        <li><a rel="tag" href="/umbraco-cms/tags/translation/" title="See all articles tagged with Translation">Translation</a></li>
      </ul></footer><section class="bios"><div class="bio">
        <div class="gravatar" title="Dan Booth"><img src="//gravatar.com/avatar/7ed6a2c2b5894c744c66710fbfadc648.jpg?d=mm&amp;s=150" srcset="//gravatar.com/avatar/7ed6a2c2b5894c744c66710fbfadc648.jpg?d=mm&amp;s=300 2x" width="150" height="150"></div>
        <h1>Dan Booth</h1>
        <p>Dan is on Twitter as <a href="//twitter.com/DanDiplo" title="Dan Booth on Twitter" rel="author">@DanDiplo</a></p>
      </div></section><section class="comments"><div id="disqus_thread"></div></section></main><nav class="dates-navbar"><a href="/umbraco-cms/2020/" class="home-link"><span class="scr-text">Home</span></a><ol>
      <li><a href="/umbraco-cms/2020/your-first-pull-request/" title="Your first pull request"><span class="scr-text">Your first pull request</span></a></li>
      <li class="selected"><a href="/umbraco-cms/2020/multilingual-websites-in-umbraco-8/" title="Multilingual Websites in Umbraco 8"><span class="scr-text">Multilingual Websites in Umbraco 8</span></a></li>
      <li><a href="/umbraco-cms/2020/static-website-with-umbraco-heartcore/" title="Static website with Umbraco Heartcore"><span class="scr-text">Static website with Umbraco Heartcore</span></a></li>
      <li><a href="/umbraco-cms/2020/umbraco-heartcore-and-nextjs/" title="Umbraco Heartcore and Next.js"><span class="scr-text">Umbraco Heartcore and Next.js</span></a></li>
      <li><a href="/umbraco-cms/2020/umbraco-8-content-apps/" title="Umbraco 8 Content Apps"><span class="scr-text">Umbraco 8 Content Apps</span></a></li>
      <li><a href="/umbraco-cms/2020/lovely-back-end/" title="Lovely Back-end"><span class="scr-text">Lovely Back-end</span></a></li>
      <li><a href="/umbraco-cms/2020/from-wannabe-to-honorary/" title="From Wannabe to Honorary"><span class="scr-text">From Wannabe to Honorary</span></a></li>
      <li><a href="/umbraco-cms/2020/tools-of-our-trade/" title="Tools of our trade"><span class="scr-text">Tools of our trade</span></a></li>
      <li><a href="/umbraco-cms/2020/grid-nouveau-block-list/" title="Grid Nouveau Block List"><span class="scr-text">Grid Nouveau Block List</span></a></li>
      <li><a href="/umbraco-cms/2020/friendly-to-the-masses/" title="Friendly to the masses"><span class="scr-text">Friendly to the masses</span></a></li>
      <li><a href="/umbraco-cms/2020/resilient-integrations/" title="Resilient integrations"><span class="scr-text">Resilient integrations</span></a></li>
      <li><a href="/umbraco-cms/2020/candid-contribution/" title="Candid Contribution"><span class="scr-text">Candid Contribution</span></a></li>
      <li><a href="/umbraco-cms/2020/qa-user-stories/" title="QA User Stories"><span class="scr-text">QA User Stories</span></a></li>
      <li><a href="/umbraco-cms/2020/tips-for-better-code-reviews/" title="Tips For Better Code Reviews"><span class="scr-text">Tips For Better Code Reviews</span></a></li>
      <li><a href="/umbraco-cms/2020/iis-builder/" title="IIS Builder"><span class="scr-text">IIS Builder</span></a></li>
      <li><a href="/umbraco-cms/2020/how-codegarden-led-to-umarketingsuite/" title="How Codegarden led to uMarketingSuite"><span class="scr-text">How Codegarden led to uMarketingSuite</span></a></li>
      <li><a href="/umbraco-cms/2020/personalisation-in-umbraco/" title="Personalisation in Umbraco"><span class="scr-text">Personalisation in Umbraco</span></a></li>
      <li><a href="/umbraco-cms/2020/umbraco-dotnet-core-config/" title="Umbraco dotnet core config"><span class="scr-text">Umbraco dotnet core config</span></a></li>
      <li><a href="/umbraco-cms/2020/configuration-files/" title="Configuration Files"><span class="scr-text">Configuration Files</span></a></li>
      <li><a href="/umbraco-cms/2020/candid-contribution-experience/" title="Candid Contribution Experience"><span class="scr-text">Candid Contribution Experience</span></a></li>
      <li><a href="/umbraco-cms/2020/empathy-in-development/" title="Empathy in Development"><span class="scr-text">Empathy in Development</span></a></li>
      <li><a href="/umbraco-cms/2020/semantics-in-web-development/" title="Semantics in web development"><span class="scr-text">Semantics in web development</span></a></li>
      <li><a href="/umbraco-cms/2020/switching-the-umbraco-backoffice-to-utility-css/" title="Switching the Umbraco backoffice to utility CSS"><span class="scr-text">Switching the Umbraco backoffice to utility CSS</span></a></li>
      <li><a href="/umbraco-cms/2020/prototyping-in-the-umbraco-backoffice/" title="Prototyping in the Umbraco Backoffice"><span class="scr-text">Prototyping in the Umbraco Backoffice</span></a></li>
      <li><a href="/umbraco-cms/2020/umbraco-block-builders/" title="Umbraco Block Builders"><span class="scr-text">Umbraco Block Builders</span></a></li>
    </ol></nav></section>


	<script type="module" src="/assets/ipuzzler.js"></script>
	<script defer src="/assets/libs.min.js"></script>
	<script defer src="/assets/app.js"></script>
	
</body>
</html>
